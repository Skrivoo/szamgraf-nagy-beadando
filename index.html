<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset=utf-8>
    <title>ThreeJs TextureLoader Example</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%
        }
    </style>
</head>

<body>

<script async src="./dist/es-module-shims.js"></script>
<script type="importmap">
{
    "imports": {
        "three": "./js-r143/build/three.module.js",
        "TrackballControls": "./js-r143/examples/jsm/controls/TrackballControls.js"
    }
}


</script>

<script type="module">
    import * as THREE from 'three';
    import {TrackballControls} from 'TrackballControls';

    // Globális változók
    let WIDTH, HEIGHT, aspectRatio;
    let scene, camera;
    let saturnGroup;
    let moonWalkerGroup;
    let renderer;
    let controls;

    init();
    animate();

    function init() {
        // Böngésző ablakméret lekérése és méretarány számítása
        HEIGHT = window.innerHeight;
        WIDTH = window.innerWidth;
        aspectRatio = WIDTH / HEIGHT;

        // Színtér létrehozása
        scene = new THREE.Scene();

        // Renderer létrehozása és DOM-hoz adása
        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(WIDTH, HEIGHT);
        renderer.setClearColor(0x000000, 1);
        document.body.appendChild(renderer.domElement);

        // Kamera létrehozása és vetítési paramétereinek beállítása
        camera = new THREE.PerspectiveCamera(75, aspectRatio, 0.1, 1000);
        camera.position.z = 15;

        //
        // Föld textúra képek:
        // http://www.solarsystemscope.com/nexus/textures/tc-earth_texture/
        //


        saturnGroup = new THREE.Group();
        const textureLoader = new THREE.TextureLoader();
        const saturnTexture = textureLoader.load('assets/texture/8k_saturn.jpg');
        const saturnRingTexture = textureLoader.load('assets/texture/saturn_circle.png');
        const wheelTexture = textureLoader.load('assets/texture/tire.png');

        const saturn = new THREE.SphereGeometry(8, 80, 80);
        const saturnMaterial = new THREE.MeshPhongMaterial({
            map: saturnTexture
        });
        const saturnMesh = new THREE.Mesh(saturn, saturnMaterial);
        const saturnRing = new THREE.RingBufferGeometry(12, 17, 64);
        const saturnRingMaterial = new THREE.MeshBasicMaterial({
            side: THREE.DoubleSide,
            transparent: true,
            map: saturnRingTexture,
            color: 0xffffff
        });
        const saturnRingMesh = new THREE.Mesh(saturnRing, saturnRingMaterial);
        saturnRingMesh.rotation.x = THREE.MathUtils.degToRad(90);
        saturnGroup.add(saturnRingMesh);
        saturnGroup.add(saturnMesh);
        //scene.add(saturnGroup);


        //holdjáró obj
        moonWalkerGroup = new THREE.Group();
        const moonWalkerBodyGroup = new THREE.Group();
        const moonWalkerSuspensionGroup = new THREE.Group();
        const moonWalkerWheelsGroup = new THREE.Group();

        //test
        const moonWalkerAxesHelper = new THREE.AxesHelper(10);
        const moonWalkerBody = new THREE.BoxGeometry(4, 6, 2, 4)
        const moonWalkerBodyMaterial = new THREE.MeshBasicMaterial({
            color: 0x888888
        });
        const moonWalkerBodyMesh = new THREE.Mesh(moonWalkerBody, moonWalkerBodyMaterial);
        moonWalkerBodyMesh.rotation.x = THREE.MathUtils.degToRad(90);
        moonWalkerBodyMesh.position.y = 1;
        moonWalkerBodyGroup.add(moonWalkerBodyMesh)

        //felfüggesztés
        const moonWalkerSuspension1 = new THREE.BoxGeometry(3.5, 2, 0.75, 4)
        const moonWalkerSuspensionMaterial1 = new THREE.MeshBasicMaterial({
            color: 0x555555
        });
        const moonWalkerSuspensionMesh1 = new THREE.Mesh(moonWalkerSuspension1, moonWalkerSuspensionMaterial1);
        moonWalkerSuspensionMesh1.rotation.x = THREE.MathUtils.degToRad(90);
        moonWalkerSuspensionMesh1.position.y = -0.25;

        const moonWalkerSuspension2 = new THREE.BoxGeometry(0.5, 9, 0.5, 4)
        const moonWalkerSuspensionMaterial2 = new THREE.MeshBasicMaterial({
            color: 0x222222
        });
        const moonWalkerSuspensionMesh2 = new THREE.Mesh(moonWalkerSuspension2, moonWalkerSuspensionMaterial2);
        moonWalkerSuspensionMesh2.rotation.x = THREE.MathUtils.degToRad(90);
        moonWalkerSuspensionMesh2.position.y = -0.35;
        moonWalkerSuspensionMesh2.position.x = 2;

        const moonWalkerSuspension3 = new THREE.BoxGeometry(0.5,9, 0.5, 4)
        const moonWalkerSuspensionMaterial3 = new THREE.MeshBasicMaterial({
            color: 0x222222
        });
        const moonWalkerSuspensionMesh3 = new THREE.Mesh(moonWalkerSuspension3, moonWalkerSuspensionMaterial3);
        moonWalkerSuspensionMesh3.rotation.x = THREE.MathUtils.degToRad(90);
        moonWalkerSuspensionMesh3.position.y = -0.35;
        moonWalkerSuspensionMesh3.position.x = -2;

        //kerekek elé 4x
        const moonWalkerSuspension4 = new THREE.BoxGeometry(0.5 ,2, 0.5, 4)
        const moonWalkerSuspensionMaterial4 = new THREE.MeshBasicMaterial({
            color: 0xffffff
        });
        const moonWalkerSuspensionMesh4 = new THREE.Mesh(moonWalkerSuspension4, moonWalkerSuspensionMaterial4);
        moonWalkerSuspensionMesh4.position.y = -1.1;
        moonWalkerSuspensionMesh4.position.x = -2.5;
        moonWalkerSuspensionMesh4.position.z = 4.25;

        const moonWalkerSuspension5 = new THREE.BoxGeometry(0.5 ,2, 0.5, 4)
        const moonWalkerSuspensionMaterial5 = new THREE.MeshBasicMaterial({
            color: 0xffffff
        });
        const moonWalkerSuspensionMesh5 = new THREE.Mesh(moonWalkerSuspension5, moonWalkerSuspensionMaterial5);
        moonWalkerSuspensionMesh5.position.y = -1.1;
        moonWalkerSuspensionMesh5.position.x = -2.5;
        moonWalkerSuspensionMesh5.position.z = -4.25;

        const moonWalkerSuspension6 = new THREE.BoxGeometry(0.5 ,2, 0.5, 4)
        const moonWalkerSuspensionMaterial6 = new THREE.MeshBasicMaterial({
            color: 0xffffff
        });
        const moonWalkerSuspensionMesh6 = new THREE.Mesh(moonWalkerSuspension6, moonWalkerSuspensionMaterial6);
        moonWalkerSuspensionMesh6.position.y = -1.1;
        moonWalkerSuspensionMesh6.position.x = 2.5;
        moonWalkerSuspensionMesh6.position.z = -4.25;

        const moonWalkerSuspension7 = new THREE.BoxGeometry(0.5 ,2, 0.5, 4)
        const moonWalkerSuspensionMaterial7 = new THREE.MeshBasicMaterial({
            color: 0xffffff
        });
        const moonWalkerSuspensionMesh7 = new THREE.Mesh(moonWalkerSuspension7, moonWalkerSuspensionMaterial7);
        moonWalkerSuspensionMesh7.position.y = -1.1;
        moonWalkerSuspensionMesh7.position.x = 2.5;
        moonWalkerSuspensionMesh7.position.z = 4.25;
        moonWalkerSuspensionGroup.add(
            moonWalkerSuspensionMesh1,
            moonWalkerSuspensionMesh2,
            moonWalkerSuspensionMesh3,
            moonWalkerSuspensionMesh4,
            moonWalkerSuspensionMesh5,
            moonWalkerSuspensionMesh6,
            moonWalkerSuspensionMesh7
        );

        //kerekek 4x
        const moonWalkerWheelMaterialTexture = new THREE.MeshBasicMaterial({
            map: wheelTexture
        });
        const moonWalkerWheelMaterialColor = new THREE.MeshBasicMaterial({
            color: 0x111111
        });
        const wheelMaterials = [
            moonWalkerWheelMaterialColor,
            moonWalkerWheelMaterialTexture,
            moonWalkerWheelMaterialTexture
        ]

        const moonWalkerWheel1 = new THREE.CylinderGeometry(1.5, 1.5, 0.5, 32)
        const moonWalkerWheelMesh1 = new THREE.Mesh(moonWalkerWheel1, wheelMaterials);
        moonWalkerWheelMesh1.rotation.z = THREE.MathUtils.degToRad(90);
        moonWalkerWheelMesh1.position.y = -2.1;
        moonWalkerWheelMesh1.position.x = 3;
        moonWalkerWheelMesh1.position.z = 4.25;

        const moonWalkerWheel2 = new THREE.CylinderGeometry(1.5, 1.5, 0.5, 32)
        const moonWalkerWheelMesh2 = new THREE.Mesh(moonWalkerWheel2, wheelMaterials);
        moonWalkerWheelMesh2.rotation.z = THREE.MathUtils.degToRad(90);
        moonWalkerWheelMesh2.position.y = -2.1;
        moonWalkerWheelMesh2.position.x = 3;
        moonWalkerWheelMesh2.position.z = -4.25;

        const moonWalkerWheel3 = new THREE.CylinderGeometry(1.5, 1.5, 0.5, 32)
        const moonWalkerWheelMesh3 = new THREE.Mesh(moonWalkerWheel3, wheelMaterials);
        moonWalkerWheelMesh3.rotation.z = THREE.MathUtils.degToRad(90);
        moonWalkerWheelMesh3.position.y = -2.1;
        moonWalkerWheelMesh3.position.x = -3;
        moonWalkerWheelMesh3.position.z = 4.25;

        const moonWalkerWheel4 = new THREE.CylinderGeometry(1.5, 1.5, 0.5, 32)
        const moonWalkerWheelMesh4 = new THREE.Mesh(moonWalkerWheel4, wheelMaterials);
        moonWalkerWheelMesh4.rotation.z = THREE.MathUtils.degToRad(90);
        moonWalkerWheelMesh4.position.y = -2.1;
        moonWalkerWheelMesh4.position.x = -3;
        moonWalkerWheelMesh4.position.z = -4.25;

        moonWalkerWheelsGroup.add(moonWalkerWheelMesh1, moonWalkerWheelMesh2, moonWalkerWheelMesh3, moonWalkerWheelMesh4);

        moonWalkerGroup.add(moonWalkerBodyGroup, moonWalkerSuspensionGroup, moonWalkerWheelsGroup, moonWalkerAxesHelper);
        scene.add(moonWalkerGroup);



        // Ambiens fény
        let ambientLight = new THREE.AmbientLight(0x202020, 1);
        scene.add(ambientLight);
        // Pontfény
        let pLight = new THREE.PointLight(0xffffff, 1);
        pLight.position.set(0, 0, 15);
        scene.add(pLight);

        controls = new TrackballControls(camera, renderer.domElement);
        controls.rotateSpeed = 5.0;
        controls.panSpeed = 1.0;

        // Az ablak átméretezése esetén visszahívható függvény megadása
        window.addEventListener('resize', handleWindowResize, false);
    }

    function handleWindowResize() {
        // Az ablak átméretezése esetén a kamera vetítési paraméterek újraszámolása
        HEIGHT = window.innerHeight;
        WIDTH = window.innerWidth;
        renderer.setSize(WIDTH, HEIGHT);
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();

        render();
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();

        //if( mesh ) {
        // Ha már létezik az objektum...
        //saturnMesh.rotation.y += 0.01;
        //}

        render();
    }

    function render() {
        renderer.render(scene, camera);
    }

</script>
</body>
</html>